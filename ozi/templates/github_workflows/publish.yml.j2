{#- OZI 0.1
# ozi/templates/github_workflows/publish.yml
# Part of the OZI Project, under the Apache License v2.0 with LLVM Exceptions.
# See LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
#}
  publish:
    runs-on: ubuntu-latest
    needs: release
    if: needs.release.outputs.drafted == 'true'
    permissions:
      contents: write
      id-token: write
    steps:
    - name: Harden Runner
      uses: step-security/harden-runner@eb238b55efaa70779f274895e782ed17c84f2895 # v2.6.1
      with:
        egress-policy: audit

    # Currently this action needs to be referred by tag. More details at:
    # https://github.com/slsa-framework/slsa-github-generator#verification-of-provenance
    - uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@07e64b653f10a80b6510f4568f685f8b7b9ea830 # v1.9.0
      with:
{%- raw %}
        provenance-name: provenance-${{ github.event.repository.name }}-${{ github.event.release.tag_name }}.intoto.jsonl
        base64-subjects: "${{ needs.release.outputs.hashes }}"
{%- endraw %}
        upload-assets: true

    - uses: OZI-Project/publish@37f120b2f1f8130d11e0d6c62b01ad2061187f59
      with:
{%- raw %}
        github-token: ${{ secrets.GITHUB_TOKEN }}
        ssh-public: ${{ env.SSH_PUBKEY }}
        ssh-private: ${{ secrets.SSH_PRVKEY }}
{%- endraw %}
